MERGE INTO {{ params.des_schema_name }}.{{ params.des_table_name }} des
USING (
      SELECT
        ID,
        HDR_ID,
        SHIPMENT_CODE,
        TT_NUMBER,
        SERVICE_CODE,
        REC_NAME,
        REC_PHONE,
        REC_EMAIL,
        REC_PROVINCE_CODE,
        REC_DISTRICT_CODE,
        REC_COMMUNE_CODE,
        REC_ADD,
        REC_POSTCODE,
        CAST(REGEXP_REPLACE(WEIGHT, '\.', '', 'g') AS BIGINT) as WEIGHT,
        LENGTH_SIZE,
        WIDTH_SIZE,
        HEIGHT_SIZE,
        CONTENT_NOTE,
        VEHICLE_TRANSPORT,
        SHIPBACK_TYPE,
        SHIPBACK_ADD,
        SHIPBACK_DATE,
        SHIPBACK_NAME,
        SHIPBACK_PHONE,
        SHIPBACK_PROVINCE_CODE,
        SHIPBACK_DISTRICT_CODE,
        SHIPBACK_COMMUNE_CODE,
        SHIPBACK_ADD_DETAIL,
        SERVICE_GTGT,
        ACCEPT_CARRY_ADDRESS,
        ACCEPT_CARRY_POSTCODE,
        PACKAGE_FEE,
        DELIVERY_NOTIFY_NAME,
        DELIVERY_NOTIFY_ADD,
        DELIVERY_NOTIFY_PHONE,
        DELIVERY_NOTIFY_EMAIL,
        DELIVERY_CHECK_AMOUNT,
        NUMBER_OF_DAY_SIGN,
        NUMBER_OF_DAY_STOCK,
        COD_AMOUNT,
        INVOICE,
        DVT,
        KHAIGIA_NDKK,
        KHAIGIA_SOLUONG,
        KHAIGIA_GIATRI,
        CANCU_TINHCUOC,
        CACH_TINHCUOC,
        THUHO_THEOLO,
        STATUS,
        UPDATED,
        TOTAL_FEE_PUBLIC,
        TOTAL_FEE_SPECIAL,
        DISPATCH_NUMBER
      FROM staging.{{ params.des_schema_name }}_{{ params.des_table_name }} ) as src
ON des.ID = src.ID
WHEN MATCHED AND src.UPDATED >= des.UPDATED THEN
    UPDATE SET
        HDR_ID = src.HDR_ID,
        SHIPMENT_CODE = src.SHIPMENT_CODE,
        TT_NUMBER = src.TT_NUMBER,
        SERVICE_CODE = src.SERVICE_CODE,
        REC_NAME = src.REC_NAME,
        REC_PHONE = src.REC_PHONE,
        REC_EMAIL = src.REC_EMAIL,
        REC_PROVINCE_CODE = src.REC_PROVINCE_CODE,
        REC_DISTRICT_CODE = src.REC_DISTRICT_CODE,
        REC_COMMUNE_CODE = src.REC_COMMUNE_CODE,
        REC_ADD = src.REC_ADD,
        REC_POSTCODE = src.REC_POSTCODE,
        WEIGHT = src.WEIGHT,
        LENGTH_SIZE = src.LENGTH_SIZE,
        WIDTH_SIZE = src.WIDTH_SIZE,
        HEIGHT_SIZE = src.HEIGHT_SIZE,
        CONTENT_NOTE = src.CONTENT_NOTE,
        VEHICLE_TRANSPORT = src.VEHICLE_TRANSPORT,
        SHIPBACK_TYPE = src.SHIPBACK_TYPE,
        SHIPBACK_ADD = src.SHIPBACK_ADD,
        SHIPBACK_DATE = src.SHIPBACK_DATE,
        SHIPBACK_NAME = src.SHIPBACK_NAME,
        SHIPBACK_PHONE = src.SHIPBACK_PHONE,
        SHIPBACK_PROVINCE_CODE = src.SHIPBACK_PROVINCE_CODE,
        SHIPBACK_DISTRICT_CODE = src.SHIPBACK_DISTRICT_CODE,
        SHIPBACK_COMMUNE_CODE = src.SHIPBACK_COMMUNE_CODE,
        SHIPBACK_ADD_DETAIL = src.SHIPBACK_ADD_DETAIL,
        SERVICE_GTGT = src.SERVICE_GTGT,
        ACCEPT_CARRY_ADDRESS = src.ACCEPT_CARRY_ADDRESS,
        ACCEPT_CARRY_POSTCODE = src.ACCEPT_CARRY_POSTCODE,
        PACKAGE_FEE = src.PACKAGE_FEE,
        DELIVERY_NOTIFY_NAME = src.DELIVERY_NOTIFY_NAME,
        DELIVERY_NOTIFY_ADD = src.DELIVERY_NOTIFY_ADD,
        DELIVERY_NOTIFY_PHONE = src.DELIVERY_NOTIFY_PHONE,
        DELIVERY_NOTIFY_EMAIL = src.DELIVERY_NOTIFY_EMAIL,
        DELIVERY_CHECK_AMOUNT = src.DELIVERY_CHECK_AMOUNT,
        NUMBER_OF_DAY_SIGN = src.NUMBER_OF_DAY_SIGN,
        NUMBER_OF_DAY_STOCK = src.NUMBER_OF_DAY_STOCK,
        COD_AMOUNT = src.COD_AMOUNT,
        INVOICE = src.INVOICE,
        DVT = src.DVT,
        KHAIGIA_NDKK = src.KHAIGIA_NDKK,
        KHAIGIA_SOLUONG = src.KHAIGIA_SOLUONG,
        KHAIGIA_GIATRI = src.KHAIGIA_GIATRI,
        CANCU_TINHCUOC = src.CANCU_TINHCUOC,
        CACH_TINHCUOC = src.CACH_TINHCUOC,
        THUHO_THEOLO = src.THUHO_THEOLO,
        STATUS = src.STATUS,
        UPDATED = src.UPDATED,
        TOTAL_FEE_PUBLIC = src.TOTAL_FEE_PUBLIC,
        TOTAL_FEE_SPECIAL = src.TOTAL_FEE_SPECIAL,
        DISPATCH_NUMBER = src.DISPATCH_NUMBER
WHEN NOT MATCHED THEN
    INSERT (
        ID,
        HDR_ID,
        SHIPMENT_CODE,
        TT_NUMBER,
        SERVICE_CODE,
        REC_NAME,
        REC_PHONE,
        REC_EMAIL,
        REC_PROVINCE_CODE,
        REC_DISTRICT_CODE,
        REC_COMMUNE_CODE,
        REC_ADD,
        REC_POSTCODE,
        WEIGHT,
        LENGTH_SIZE,
        WIDTH_SIZE,
        HEIGHT_SIZE,
        CONTENT_NOTE,
        VEHICLE_TRANSPORT,
        SHIPBACK_TYPE,
        SHIPBACK_ADD,
        SHIPBACK_DATE,
        SHIPBACK_NAME,
        SHIPBACK_PHONE,
        SHIPBACK_PROVINCE_CODE,
        SHIPBACK_DISTRICT_CODE,
        SHIPBACK_COMMUNE_CODE,
        SHIPBACK_ADD_DETAIL,
        SERVICE_GTGT,
        ACCEPT_CARRY_ADDRESS,
        ACCEPT_CARRY_POSTCODE,
        PACKAGE_FEE,
        DELIVERY_NOTIFY_NAME,
        DELIVERY_NOTIFY_ADD,
        DELIVERY_NOTIFY_PHONE,
        DELIVERY_NOTIFY_EMAIL,
        DELIVERY_CHECK_AMOUNT,
        NUMBER_OF_DAY_SIGN,
        NUMBER_OF_DAY_STOCK,
        COD_AMOUNT,
        INVOICE,
        DVT,
        KHAIGIA_NDKK,
        KHAIGIA_SOLUONG,
        KHAIGIA_GIATRI,
        CANCU_TINHCUOC,
        CACH_TINHCUOC,
        THUHO_THEOLO,
        STATUS,
        UPDATED,
        TOTAL_FEE_PUBLIC,
        TOTAL_FEE_SPECIAL,
        DISPATCH_NUMBER
    )
    VALUES (
        src.ID,
        src.HDR_ID,
        src.SHIPMENT_CODE,
        src.TT_NUMBER,
        src.SERVICE_CODE,
        src.REC_NAME,
        src.REC_PHONE,
        src.REC_EMAIL,
        src.REC_PROVINCE_CODE,
        src.REC_DISTRICT_CODE,
        src.REC_COMMUNE_CODE,
        src.REC_ADD,
        src.REC_POSTCODE,
        src.WEIGHT,
        src.LENGTH_SIZE,
        src.WIDTH_SIZE,
        src.HEIGHT_SIZE,
        src.CONTENT_NOTE,
        src.VEHICLE_TRANSPORT,
        src.SHIPBACK_TYPE,
        src.SHIPBACK_ADD,
        src.SHIPBACK_DATE,
        src.SHIPBACK_NAME,
        src.SHIPBACK_PHONE,
        src.SHIPBACK_PROVINCE_CODE,
        src.SHIPBACK_DISTRICT_CODE,
        src.SHIPBACK_COMMUNE_CODE,
        src.SHIPBACK_ADD_DETAIL,
        src.SERVICE_GTGT,
        src.ACCEPT_CARRY_ADDRESS,
        src.ACCEPT_CARRY_POSTCODE,
        src.PACKAGE_FEE,
        src.DELIVERY_NOTIFY_NAME,
        src.DELIVERY_NOTIFY_ADD,
        src.DELIVERY_NOTIFY_PHONE,
        src.DELIVERY_NOTIFY_EMAIL,
        src.DELIVERY_CHECK_AMOUNT,
        src.NUMBER_OF_DAY_SIGN,
        src.NUMBER_OF_DAY_STOCK,
        src.COD_AMOUNT,
        src.INVOICE,
        src.DVT,
        src.KHAIGIA_NDKK,
        src.KHAIGIA_SOLUONG,
        src.KHAIGIA_GIATRI,
        src.CANCU_TINHCUOC,
        src.CACH_TINHCUOC,
        src.THUHO_THEOLO,
        src.STATUS,
        src.UPDATED,
        src.TOTAL_FEE_PUBLIC,
        src.TOTAL_FEE_SPECIAL,
        src.DISPATCH_NUMBER
    );
