MERGE INTO {{ params.des_schema_name }}.{{ params.des_table_name }} des
USING staging.{{ params.des_schema_name }}_{{ params.des_table_name }} src
ON des.ID = src.ID
WHEN MATCHED AND src.UPDATED >= des.UPDATED THEN
    UPDATE SET
        SHBG = src.SHBG,
        MALO = src.MALO,
        SERVICE_CODE = src.SERVICE_CODE,
        FEE_PUBLIC = src.FEE_PUBLIC,
        FEEBEFORETAX_PUBLIC = src.FEEBEFORETAX_PUBLIC,
        TAX_PUBLIC = src.TAX_PUBLIC,
        TAXRATE_PUBLIC = src.TAXRATE_PUBLIC,
        FEE_SPECIAL = src.FEE_SPECIAL,
        FEEBEFORETAX_SPECIAL = src.FEEBEFORETAX_SPECIAL,
        TAX_SPECIAL = src.TAX_SPECIAL,
        TAXRATE_SPECIAL = src.TAXRATE_SPECIAL,
        DTL_ID = src.DTL_ID,
        MESS_ERROR = src.MESS_ERROR,
        FEE_PUBLIC_PB = src.FEE_PUBLIC_PB,
        FEEBEFORETAX_PUBLIC_PB = src.FEEBEFORETAX_PUBLIC_PB,
        FEE_SPECIAL_PB = src.FEE_SPECIAL_PB,
        FEEBEFORETAX_SPECIAL_PB = src.FEEBEFORETAX_SPECIAL_PB,
        TAX_PUBLIC_PB = src.TAX_PUBLIC_PB,
        TAX_SPECIAL_PB = src.TAX_SPECIAL_PB,
        UPDATED = src.UPDATED,
        CASE_ID = src.CASE_ID,
        VER = src.VER,
        TRAN_SIGN = src.TRAN_SIGN,
        MESS_ERROR_SPECIAL = src.MESS_ERROR_SPECIAL,
        ORIGINAL_DTL_ID = src.ORIGINAL_DTL_ID,
        BDT_CODE = src.BDT_CODE
WHEN NOT MATCHED THEN
    INSERT (
        SHBG,
        MALO,
        SERVICE_CODE,
        FEE_PUBLIC,
        FEEBEFORETAX_PUBLIC,
        TAX_PUBLIC,
        TAXRATE_PUBLIC,
        FEE_SPECIAL,
        FEEBEFORETAX_SPECIAL,
        TAX_SPECIAL,
        TAXRATE_SPECIAL,
        ID,
        DTL_ID,
        MESS_ERROR,
        FEE_PUBLIC_PB,
        FEEBEFORETAX_PUBLIC_PB,
        FEE_SPECIAL_PB,
        FEEBEFORETAX_SPECIAL_PB,
        TAX_PUBLIC_PB,
        TAX_SPECIAL_PB,
        UPDATED,
        CASE_ID,
        VER,
        TRAN_SIGN,
        MESS_ERROR_SPECIAL,
        ORIGINAL_DTL_ID,
        BDT_CODE
    )
    VALUES (
        src.SHBG,
        src.MALO,
        src.SERVICE_CODE,
        src.FEE_PUBLIC,
        src.FEEBEFORETAX_PUBLIC,
        src.TAX_PUBLIC,
        src.TAXRATE_PUBLIC,
        src.FEE_SPECIAL,
        src.FEEBEFORETAX_SPECIAL,
        src.TAX_SPECIAL,
        src.TAXRATE_SPECIAL,
        src.ID,
        src.DTL_ID,
        src.MESS_ERROR,
        src.FEE_PUBLIC_PB,
        src.FEEBEFORETAX_PUBLIC_PB,
        src.FEE_SPECIAL_PB,
        src.FEEBEFORETAX_SPECIAL_PB,
        src.TAX_PUBLIC_PB,
        src.TAX_SPECIAL_PB,
        src.UPDATED,
        src.CASE_ID,
        src.VER,
        src.TRAN_SIGN,
        src.MESS_ERROR_SPECIAL,
        src.ORIGINAL_DTL_ID,
        src.BDT_CODE
    );
